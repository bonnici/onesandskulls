function enableFileInput(){$("#file-input-button").removeClass("disabled")}function getParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1])}function renderDataParam(){try{var a=LZString.decompressFromEncodedURIComponent(dataParam),b=JSONC.decompress(JSON.parse(a));renderReplayData(b,dataParam)}catch(a){$("#loading").hide(),$("#data-param-error").show(),console.error(a)}}function showResultsAd(){0==$("#middle-ad").find("ins").length&&$("#middle-ad").html(adUnit)}function renderReplayData(a,b){var c="http://onesandskulls.com",d="/index.html",e=c+d+"?data="+b,f=encodeURIComponent(e),g="http://tinyurl.com/create.php?url="+f+"#success",h=stats.calculateStats(a.actions,a.playerDetails);updateGameDetails(a.gameDetails),updateActions(a.actions,a.gameDetails,a.playerDetails),$("#loading").hide(),$("#summary-div").show(),$("#results-div").show(),showResultsAd(),$("#blockdice").show(),$("#share-massive-url").attr("href",e),$("#share-tiny-url").attr("href",g),$("#share-alert").show(),$(".other-stats").remove(),drawCharts(h,a.gameDetails),document.getElementById("results-with-padding").scrollIntoView()}function raceIdToName(a){switch(a){case 1:return"Human";case 2:return"Dwarf";case 3:return"Skaven";case 4:return"Orc";case 5:return"Lizardman";case 7:return"Wood Elf";case 8:return"Chaos";case 9:return"Dark Elf";case 15:return"High Elf";case 24:return"Bretonnian";default:return a}}function rollTypeIdToName(a){switch(a){case-2:return"Kickoff Scatter";case-1:return"Kickoff";case 1:return"GFI";case 2:return"Dodge";case 3:return"Armour";case 4:return"Injury";case 5:return"Block";case 6:return"Stand Up";case 7:return"Pickup";case 8:return"Casualty";case 9:return"Catch";case 10:return"Scatter";case 11:return"Throw-in";case 12:return"Pass";case 16:return"Intercept";case 17:return"Wake-Up After KO";case 20:return"Bone-Head";case 21:return"Really Stupid";case 22:return"Wild Animal";case 23:return"Loner";case 24:return"Landing";case 26:return"Inaccurate Pass Scatter";case 29:return"Dauntless";case 27:return"Always Hungry";case 31:return"Jump Up";case 34:return"Stab";case 36:return"Leap";case 37:return"Foul Appearance";case 40:return"Take Root";case 42:return"Hail Mary Pass";case 45:return"Pro";case 46:return"Hypnotic Gaze";case 54:return"Fireball";case 55:return"Lightning Bolt";case 56:return"Throw Team-Mate";case 58:return"Kickoff Gust";case 59:return"Armour";case 60:return"Injury";default:return a}}function diceIdToName(a,b){if(5!=b)return a;switch(a){case 0:return"AD";case 1:return"BD";case 2:return"P";case 3:return"DS";case 4:return"DD";default:return a}}function twoDBDiceToName(a){switch(a){case 0:return"AD AD";case 1:return"AD BD";case 2:return"AD P";case 3:return"AD DS";case 4:return"AD DD";case 5:return"BD BD";case 6:return"BD P";case 7:return"BD DS";case 8:return"BD DD";case 9:return"P P";case 10:return"P DS";case 11:return"P DD";case 12:return"DS DS";case 13:return"DS DD";case 14:return"DD DD";default:return a}}function injuryDiceToName(a){switch(a){case 0:return"Stunned";case 1:return"KO'd";case 2:return"Casualty";default:return a}}function casualtyDiceToName(a){switch(a){case 0:return"No Long Term Effect";case 1:return"Miss Next Game";case 2:return"Niggling Injury";case 3:return"-1 MA";case 4:return"-1 AV";case 5:return"-1 AG";case 6:return"-1 ST";case 7:return"Dead";default:return a}}function diceToName(a,b){return 0==b?diceIdToName(a,5):b==-1?twoDBDiceToName(a):3==b?a+2:4==b?a+2:5==b?casualtyDiceToName(a):a+1}function updateGameDetails(a){$("#file-name").text(a.fileName),$("#home-coach").text(a.homeTeam.coachName),$("#home-team").text(a.homeTeam.teamName),$("#home-race").text(raceIdToName(a.homeTeam.raceId)),$("#home-score").text(a.homeTeam.score),$("#away-coach").text(a.awayTeam.coachName),$("#away-team").text(a.awayTeam.teamName),$("#away-race").text(raceIdToName(a.awayTeam.raceId)),$("#away-score").text(a.awayTeam.score),$("#stadium-name").text(a.stadiumName)}function updateActions(a,b,c){$("#roll-details-table tbody").empty(),$.each(a,function(a,d){var e=$.map(d.dice,function(a){return diceIdToName(a,d.rollType)}),f=0==d.team?b.homeTeam.teamName:b.awayTeam.teamName,g=0==d.team?"home":"away",h=g;d.player in c&&(h=0==c[d.player].teamId?"home":"away"),$("#roll-details-table tbody").append('<tr><td class="'+g+'">'+d.turn+" ("+f+')</td><td class="'+h+'">'+(d.player in c?c[d.player].name:"N/A")+'</td><td class="'+h+'">'+rollTypeIdToName(d.rollType)+'</td><td class="'+h+'">'+e.join(" ")+"</td></tr>")})}function drawCharts(a,b){drawStatCharts("1DB","1dbs",a["1db"],b),delete a["1db"],drawStatCharts("2DB","2dbs",a["2db"],b),delete a["2db"],drawStatCharts("Dodge","dodges",a[2],b),delete a[2],drawStatCharts("Armour","armour",a.armour,b),delete a.armour,drawStatCharts("All Block Dice","allblocks",a.block,b),delete a.block,drawStatCharts("All Six-Sided (non-Block) Dice","sixsided",a.standard,b),delete a.standard,drawStatCharts("All Scatter Dice","scatter",a.scatter,b),delete a.scatter,drawStatCharts("Injury","injury",a.injury,b),delete a.injury,drawStatCharts("Casualty","cas",a.casualty,b),delete a.casualty,$.each(a,function(a,c){makeChartDiv(a),drawStatCharts(rollTypeIdToName(parseInt(a)),a,c,b)})}function roundedPercent(a){var b=100*a;return Math.round(100*b)/100}function adjustIndex(a,b){if(b!=-1)return a+1;switch(a){case 0:return 1;case 1:return 5;case 2:return 11;case 3:return 6;case 4:return 7;case 5:return 2;case 6:return 12;case 7:return 8;case 8:return 9;case 9:return 13;case 10:return 14;case 11:return 15;case 12:return 3;case 13:return 10;case 14:return 4;default:return a+1}}function drawStatCharts(a,b,c,d){var e="auto";switch(c.diceType){case 1:e=[1,2,3,4,5,6];break;case 2:e=[1,2,3,4,5,6,7,8];break;case 3:case 4:e=[2,3,4,5,6,7,8,9,10,11,12]}var f={title:a+" Percentages",seriesType:"bars",series:{2:{type:"line"}},legend:{position:"none"},hAxis:{ticks:e},focusTarget:"category",width:600,height:300},g={title:a+" Counts",seriesType:"bars",legend:{position:"none"},hAxis:{ticks:e},focusTarget:"category",width:600,height:300},h=[["Result",d.homeTeam.teamName,d.awayTeam.teamName,"Expected"]],i=[["Result",d.homeTeam.teamName,d.awayTeam.teamName]],j=0,k=0,l=0,m=0;$.each(c[0].histogram,function(a,b){if(!isNaN(b)){var d=c[1].histogram[a],e=diceToName(a,c.diceType),f=0==b?0:roundedPercent(parseFloat(b)/c[0].total),g=0==d?0:roundedPercent(parseFloat(d)/c[1].total),n=roundedPercent(c.expected[a]),o=adjustIndex(a,c.diceType);h[o]=[e,f,g,n],i[o]=[e,b,d],j+=b,k+=d,l+=b*(a+1),m+=d*(a+1)}});var n=null,o=null;1==c.diceType&&(n=l/j,o=m/k),g.title+="\nTotals - "+d.homeTeam.teamName+": "+j,null!==n&&j>0&&(g.title+=" ("+n.toFixed(2)+" mean)"),g.title+=", "+d.awayTeam.teamName+": "+k,null!==o&&k>0&&(g.title+=" ("+o.toFixed(2)+" mean)");var p=google.visualization.arrayToDataTable(h),q=new google.visualization.ComboChart(document.getElementById(b+"-pct-chart"));q.draw(p,f);var r=google.visualization.arrayToDataTable(i),s=new google.visualization.ComboChart(document.getElementById(b+"-count-chart"));s.draw(r,g)}function makeChartDiv(a){var b=$("#other-stats-template").clone().show();b.removeAttr("id").addClass("other-stats"),b.find(".pct-chart").attr("id",a+"-pct-chart"),b.find(".count-chart").attr("id",a+"-count-chart"),b.appendTo($("#charts"))}google.load("visualization","1.0",{packages:["corechart"]}),google.setOnLoadCallback(enableFileInput);var fileInput=document.getElementById("file-input");fileInput.addEventListener("change",function(){fileInput.files.length>0&&($("#loading").show(),$("#data-param-error").hide(),$("#summary-div").hide(),$("#results-div").hide(),$("#share-alert").hide(),$("#blockdice").hide(),io.xmlToJson(fileInput.files[0],function(a){var b=replay.processReplay(a),c=JSONC.compress(b),d=JSON.stringify(c),e=LZString.compressToEncodedURIComponent(d);renderReplayData(b,e)},function(a){$("#loading").hide(),alert(a)}))});var dataParam=getParameterByName("data");dataParam&&($("#loading").show(),$("#data-param-error").hide(),google.setOnLoadCallback(renderDataParam));var adUnit='<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> \n\t<!-- Ones and Skulls results --> \n   <ins class="adsbygoogle" \n       style="display:block" \n       data-ad-client="ca-pub-4369217296754794" \n       data-ad-slot="9894359687" \n       data-ad-format="auto"></ins> \n<script> \n\t(adsbygoogle = window.adsbygoogle || []).push({}); \n</script>';