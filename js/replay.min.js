function extractGameDetails(e){var t=e.replay.replaystep[0],a=e.replay.replaystep[e.replay.replaystep.length-1];return{stadiumName:t.gameinfos.namestadium,homeTeam:{coachName:t.gameinfos.coachesinfos.coachinfos[0].userid,teamName:t.boardstate.listteams.teamstate[0].data.name,raceId:t.boardstate.listteams.teamstate[0].data.idrace,score:a.ruleseventgamefinished.matchresult.row.homescore||0},awayTeam:{coachName:t.gameinfos.coachesinfos.coachinfos[1].userid,teamName:t.boardstate.listteams.teamstate[1].data.name,raceId:t.boardstate.listteams.teamstate[1].data.idrace,score:a.ruleseventgamefinished.matchresult.row.awayscore||0}}}function translateStringNumberList(e){if(!e)return[];for(var t=e.substring(1,e.length-1),a=t.split(","),r=[],s=0;s<a.length;s++)r.push(parseInt(a[s]));return r}function extractPlayerDetails(e,t){var a=(((e||{}).boardstate||{}).listteams||{}).teamstate;!a||a.length<2||(extractPlayerDetailsFromTeamState(a[0],t),extractPlayerDetailsFromTeamState(a[1],t))}function extractPlayerDetailsFromTeamState(e,t){var a=((e||{}).listpitchplayers||{}).playerstate;if(a)for(var r=0;r<a.length;r++){var s=a[r];s.id in t||(t[s.id]={id:s.id,teamId:s.data.teamid||0,type:s.data.idplayertypes,name:s.data.name})}}function extractActionsFromStep(e,t){var a=extractKickoffDetails(e);a&&t.push(a);var r=e.ruleseventboardaction;if(r&&r.length)for(var s=0;s<r.length;s++){var l=r[s];processAction(e,l,t)}else r&&processAction(e,r,t)}function processAction(e,t,a){if(t){var r=t.results.boardactionresult;if(r&&r.length)for(var s=0;s<r.length;s++){var l=r[s];processResult(e,t,l,a)}else processResult(e,t,r,a)}}function processResult(e,t,a,r){if(a&&a.coachchoices&&a.coachchoices.listdices){var s=extractActionDetails(e,t,a);s&&r.push(s)}}function extractActionDetails(e,t,a){if(ignoreResult(a))return null;var r=translateDice(a.coachchoices.listdices,a.rolltype);return 10==a.rolltype&&r.length>1&&(a.rolltype=-2),{team:e.boardstate.activeteam||0,turn:e.boardstate.listteams.teamstate[e.boardstate.activeteam||0].gameturn||0,player:t.playerid,rollType:a.rolltype,dice:r}}function ignoreResult(e){return 2==e.rollstatus?!0:15==e.rolltype?!0:61==e.rolltype?!0:5==e.rolltype&&2!=e.resulttype?!0:8==e.rolltype&&2!=e.resulttype&&1!=e.subresulttype?!0:!1}function translateDice(e,t){var a=translateStringNumberList(e);return 5==t?a=a.slice(0,a.length/2):8==t&&(a=a.slice(0,a.length/2),a=[a[a.length-1]]),a}function extractKickoffDetails(e){return e.ruleseventkickofftable?{team:e.boardstate.activeteam||0,turn:e.boardstate.listteams.teamstate[e.boardstate.activeteam||0].gameturn||0,player:null,rollType:-1,dice:translateDice(e.ruleseventkickofftable.listdice,-1)}:null}replay={processReplay:function(e){for(var t=extractGameDetails(e),a={},r=[],s=0;s<e.replay.replaystep.length;s++){var l=e.replay.replaystep[s];extractPlayerDetails(l,a),extractActionsFromStep(l,r)}return{gameDetails:t,playerDetails:a,actions:r,version:1}}};